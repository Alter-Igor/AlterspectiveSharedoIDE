<div class="Alt-AdviceBulkManager">
    <div data-bind="widgetChrome:{icon:'fa-tasks', title:'Bulk Advice Manager'}">
        <!-- Keyboard Shortcuts Help -->
        <div class="keyboard-help" data-bind="visible: model.showKeyboardHelp">
            <div class="help-content">
                <h5>Keyboard Shortcuts</h5>
                <ul>
                    <li><kbd>Ctrl+A</kbd> Select all visible items</li>
                    <li><kbd>Ctrl+D</kbd> Deselect all</li>
                    <li><kbd>Ctrl+E</kbd> Export selected to CSV</li>
                    <li><kbd>R</kbd> Refresh list</li>
                    <li><kbd>P</kbd> Pause selected items</li>
                    <li><kbd>U</kbd> Resume selected items</li>
                    <li><kbd>?</kbd> Toggle this help</li>
                </ul>
                <button class="btn btn-sm btn-default" data-bind="click: function() { model.showKeyboardHelp(false); }">
                    <i class="fa fa-times"></i> Close
                </button>
            </div>
        </div>
        
        <!-- Toolbar -->
        <div class="bulk-manager-toolbar">
            <div class="toolbar-left">
                <button class="btn btn-sm btn-primary" data-bind="click: function() { loadWorkItems(false); }, disable: model.isLoading()" title="Refresh (R)">
                    <i class="fa fa-refresh" data-bind="css: { 'fa-spin': model.isLoading() }"></i> Refresh
                </button>
                
                <button class="btn btn-sm btn-default" data-bind="click: function() { model.showKeyboardHelp(!model.showKeyboardHelp()); }" title="Keyboard shortcuts">
                    <i class="fa fa-keyboard-o"></i>
                </button>
                
                <div class="btn-group">
                    <button class="btn btn-sm btn-default" data-bind="click: selectAll, disable: model.isLoading() || model.workItems().length === 0" title="Select All (Ctrl+A)">
                        <i class="fa fa-check-square-o"></i> Select All
                    </button>
                    <button class="btn btn-sm btn-default" data-bind="click: deselectAll, disable: model.isLoading() || model.workItems().length === 0" title="Deselect All (Ctrl+D)">
                        <i class="fa fa-square-o"></i> Deselect All
                    </button>
                </div>
                
                <span class="selection-count" data-bind="visible: model.selectedCount() > 0">
                    <span data-bind="text: model.selectedCount"></span> selected
                </span>
            </div>
            
            <div class="toolbar-right">
                <div class="search-group">
                    <input type="text" class="form-control input-sm" placeholder="Search work items..." 
                           data-bind="value: model.searchTerm, valueUpdate: 'keyup'" />
                    <i class="fa fa-search search-icon"></i>
                </div>
                <div class="filter-group">
                    <label>Filter:</label>
                    <select class="form-control input-sm" data-bind="value: model.filterStatus">
                        <option value="all">All Items</option>
                        <option value="active">Active Only</option>
                        <option value="paused">Paused Only</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Bulk Actions -->
        <div class="bulk-actions-panel" data-bind="visible: model.selectedCount() > 0">
            <div class="bulk-actions-header">
                <h4>Bulk Actions</h4>
            </div>
            
            <div class="bulk-actions-content">
                <div class="action-group">
                    <button class="btn btn-success" data-bind="click: bulkResume, enable: model.canResume()">
                        <i class="fa fa-play"></i> Resume Selected (<span data-bind="text: model.pausedSelectedCount"></span>)
                    </button>
                    
                    <button class="btn btn-warning" data-bind="click: showBulkPauseModal, enable: model.canPause()">
                        <i class="fa fa-pause"></i> Pause Selected (<span data-bind="text: model.activeSelectedCount"></span>)
                    </button>
                </div>
                
                <div class="action-group">
                    <button class="btn btn-info" data-bind="click: exportSelected">
                        <i class="fa fa-download"></i> Export to CSV
                    </button>
                    
                    <button class="btn btn-default" data-bind="click: showBulkAssignModal">
                        <i class="fa fa-user"></i> Reassign
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Work Items Table -->
        <div class="work-items-container">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th width="30">
                            <input type="checkbox" data-bind="checked: model.allSelected, click: toggleSelectAll" />
                        </th>
                        <th>Work Item</th>
                        <th width="100">Status</th>
                        <th width="150">Last Action</th>
                        <th width="100">Days Active</th>
                        <th width="120">Actions</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: model.filteredItems">
                    <tr data-bind="css: { 'row-paused': status() === 'paused' }">
                        <td>
                            <input type="checkbox" data-bind="checked: selected" />
                        </td>
                        <td>
                            <div class="work-item-title" data-bind="text: title"></div>
                            <div class="work-item-id" data-bind="text: '#' + id"></div>
                        </td>
                        <td>
                            <span class="status-badge" data-bind="text: status, css: { 'status-active': status() === 'active', 'status-paused': status() === 'paused' }"></span>
                        </td>
                        <td>
                            <span class="last-action" data-bind="text: lastAction"></span>
                        </td>
                        <td>
                            <span data-bind="text: daysActive"></span>
                        </td>
                        <td>
                            <!-- ko if: status() === 'paused' -->
                            <button class="btn btn-xs btn-success" data-bind="click: $parent.resumeSingle" title="Resume">
                                <i class="fa fa-play"></i>
                            </button>
                            <!-- /ko -->
                            <!-- ko if: status() === 'active' -->
                            <button class="btn btn-xs btn-warning" data-bind="click: $parent.pauseSingle" title="Pause">
                                <i class="fa fa-pause"></i>
                            </button>
                            <!-- /ko -->
                            <button class="btn btn-xs btn-default" data-bind="click: $parent.viewDetails" title="Details">
                                <i class="fa fa-info-circle"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <!-- Pagination -->
            <div class="pagination-container" data-bind="visible: model.totalPages() > 1">
                <ul class="pagination">
                    <li data-bind="css: { disabled: model.currentPage() === 1 }">
                        <a href="#" data-bind="click: previousPage">
                            <i class="fa fa-chevron-left"></i> Previous
                        </a>
                    </li>
                    <!-- ko foreach: model.pageNumbers -->
                    <li data-bind="css: { active: $data === $parent.model.currentPage() }">
                        <a href="#" data-bind="text: $data, click: function() { $parent.goToPage($data); }"></a>
                    </li>
                    <!-- /ko -->
                    <li data-bind="css: { disabled: model.currentPage() === model.totalPages() }">
                        <a href="#" data-bind="click: nextPage">
                            Next <i class="fa fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
                <div class="pagination-info">
                    Showing <span data-bind="text: model.startItem"></span> - <span data-bind="text: model.endItem"></span> 
                    of <span data-bind="text: model.totalItems"></span> items
                </div>
            </div>
            
            <!-- Undo Notification -->
            <div class="undo-notification" data-bind="visible: model.showUndo()">
                <span data-bind="text: model.undoMessage"></span>
                <button class="btn btn-xs btn-primary" data-bind="click: undoLastAction">
                    <i class="fa fa-undo"></i> Undo
                </button>
                <button class="btn btn-xs btn-link" data-bind="click: dismissUndo">Dismiss</button>
            </div>
            
            <!-- Empty State -->
            <div class="empty-state" data-bind="visible: model.workItems().length === 0 && !model.isLoading()">
                <i class="fa fa-inbox fa-3x"></i>
                <p>No work items found</p>
                <button class="btn btn-primary" data-bind="click: loadWorkItems">Load Work Items</button>
            </div>
            
            <!-- Loading State -->
            <div class="loading-state" data-bind="visible: model.isLoading()">
                <i class="fa fa-spinner fa-spin fa-2x"></i>
                <p data-bind="text: model.loadingMessage"></p>
            </div>
            
            <!-- Error State -->
            <div class="error-state" data-bind="visible: model.hasError() && !model.isLoading()">
                <i class="fa fa-exclamation-triangle fa-3x"></i>
                <p data-bind="text: model.errorMessage"></p>
                <button class="btn btn-primary" data-bind="click: function() { loadWorkItems(false); }">
                    <i class="fa fa-refresh"></i> Try Again
                </button>
            </div>
        </div>
        
        <!-- Bulk Pause Modal -->
        <div class="modal fade" id="bulkPauseModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-bind="click: function() { $('#bulkPauseModal').fadeOut(); $('.modal-backdrop').remove(); }">&times;</button>
                        <h4 class="modal-title">Pause Multiple Items</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Reason for Pause:</label>
                            <select class="form-control" data-bind="value: model.bulkPauseReason">
                                <option value="Client Request">Client Request</option>
                                <option value="Awaiting Information">Awaiting Information</option>
                                <option value="Resource Constraints">Resource Constraints</option>
                                <option value="Strategic Review">Strategic Review</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <!-- ko if: model.bulkPauseReason() === 'Other' -->
                        <div class="form-group">
                            <label>Custom Reason:</label>
                            <textarea class="form-control" rows="3" data-bind="value: model.customPauseReason" placeholder="Enter reason..."></textarea>
                        </div>
                        <!-- /ko -->
                        <div class="alert alert-warning">
                            <i class="fa fa-exclamation-triangle"></i> This will pause <strong data-bind="text: model.activeSelectedCount"></strong> active advice items.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-bind="click: function() { $('#bulkPauseModal').fadeOut(); $('.modal-backdrop').remove(); }">Cancel</button>
                        <button type="button" class="btn btn-warning" data-bind="click: bulkPause">
                            <i class="fa fa-pause"></i> Pause Items
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>