<div class="advice-status-controller-designer">
    <!-- Header Section -->
    <div class="designer-header" data-bind="click: toggleExpanded">
        <div class="header-content">
            <i class="fa fa-code-fork designer-icon"></i>
            <span class="designer-title">Advice Status Controller</span>
            <span class="configuration-summary" data-bind="text: getConfigurationSummary"></span>
            <div class="header-actions">
                <button type="button" class="btn btn-link btn-sm info-button" 
                        data-bind="click: showInfo" 
                        title="Show detailed information about this workflow action">
                    <i class="fa fa-info-circle text-info"></i>
                </button>
                <i class="fa toggle-icon" data-bind="css: { 'fa-chevron-down': !isExpanded(), 'fa-chevron-up': isExpanded() }"></i>
            </div>
        </div>
    </div>
    
    <!-- Configuration Content -->
    <div class="designer-content" data-bind="visible: isExpanded">
        
        <!-- Validation Message -->
        <!-- ko if: validationMessage() -->
        <div class="alert alert-warning">
            <i class="fa fa-exclamation-triangle"></i>
            <span data-bind="text: validationMessage"></span>
        </div>
        <!-- /ko -->
        
        <!-- Variable Mappings Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-exchange"></i>
                Variable Mappings
            </h4>
            
            <div class="form-row">
                <div class="col-md-6">
                    <label>Work Item ID Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.workItemIdVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.workItemIdVariable,
                        placeholder: 'Select work item ID variable...',
                        required: true
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-6">
                    <label>Pause Reason Variable (Optional)</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.pauseReasonVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.pauseReasonVariable,
                        placeholder: 'Select pause reason variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
            </div>
        </div>
        
        <!-- Output Mappings Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-arrow-right"></i>
                Output Variables
            </h4>
            
            <div class="form-row">
                <div class="col-md-4">
                    <label>Success Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.successVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.successVariable,
                        placeholder: 'Select success variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Action Taken Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.actionTakenVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.actionTakenVariable,
                        placeholder: 'Select action taken variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Current Status Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.currentStatusVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.currentStatusVariable,
                        placeholder: 'Select current status variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
            </div>
            
            <div class="form-row">
                <div class="col-md-4">
                    <label>Paused Date Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.pausedDateVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.pausedDateVariable,
                        placeholder: 'Select paused date variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Resumed Date Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.resumedDateVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.resumedDateVariable,
                        placeholder: 'Select resumed date variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Last Action Date Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.lastActionDateVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.lastActionDateVariable,
                        placeholder: 'Select last action date variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
            </div>
        </div>
        
        <!-- Action Configuration Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-cogs"></i>
                Action Configuration
            </h4>
            
            <div class="form-row">
                <div class="col-md-6">
                    <label>Default Action</label>
                    <!-- ko if: viewModel && viewModel.config && viewModel.config.defaultAction -->
                    <select class="form-control" data-bind="
                        options: availableActions,
                        optionsText: 'text',
                        optionsValue: 'value',
                        value: viewModel.config.defaultAction">
                    </select>
                    <!-- /ko -->
                    <small class="form-text text-muted">Action to take when no conditions match</small>
                </div>
                <div class="col-md-6">
                    <label>
                        <!-- ko if: viewModel && viewModel.config && viewModel.config.requireConfirmation -->
                        <input type="checkbox" data-bind="checked: viewModel.config.requireConfirmation" />
                        <!-- /ko -->
                        Require Confirmation
                    </label>
                    <small class="form-text text-muted">Require user confirmation before taking action</small>
                </div>
            </div>
        </div>
        
        <!-- Conditions Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-list"></i>
                Conditions
                <button type="button" class="btn btn-sm btn-primary ml-2" data-bind="click: addCondition">
                    <i class="fa fa-plus"></i> Add Condition
                </button>
            </h4>
            
            <!-- ko if: viewModel && viewModel.config && viewModel.config.conditions -->
            <!-- ko if: viewModel.config.conditions().length === 0 -->
            <div class="alert alert-info">
                <i class="fa fa-info-circle"></i>
                No conditions defined. The default action will always be used.
            </div>
            <!-- /ko -->
            
            <!-- ko foreach: viewModel.config.conditions -->
            <div class="condition-row">
                <div class="form-row">
                    <div class="col-md-4">
                        <label>When Status Is</label>
                        <select class="form-control" data-bind="
                            options: $parent.availableConditions,
                            optionsText: 'text',
                            optionsValue: 'value',
                            value: when">
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label>Then Action</label>
                        <select class="form-control" data-bind="
                            options: $parent.availableActions,
                            optionsText: 'text',
                            optionsValue: 'value',
                            value: then">
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label>&nbsp;</label>
                        <div>
                            <button type="button" class="btn btn-sm btn-danger" data-bind="click: $parent.removeCondition">
                                <i class="fa fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->
        </div>
        
        <!-- Advanced Options -->
        <div class="configuration-section">
            <h4 class="section-title" data-bind="click: toggleAdvancedOptions" style="cursor: pointer;">
                <i class="fa" data-bind="css: { 'fa-chevron-right': !showAdvancedOptions(), 'fa-chevron-down': showAdvancedOptions() }"></i>
                Advanced Options
            </h4>
            
            <div data-bind="visible: showAdvancedOptions">
                <div class="form-row">
                    <div class="col-md-6">
                        <label>
                            <!-- ko if: viewModel && viewModel.config && viewModel.config.enableLogging -->
                            <input type="checkbox" data-bind="checked: viewModel.config.enableLogging" />
                            <!-- /ko -->
                            Enable Detailed Logging
                        </label>
                        <small class="form-text text-muted">Log detailed execution information</small>
                    </div>
                    <div class="col-md-6">
                        <label>
                            <!-- ko if: viewModel && viewModel.config && viewModel.config.retryOnFailure -->
                            <input type="checkbox" data-bind="checked: viewModel.config.retryOnFailure" />
                            <!-- /ko -->
                            Retry on Failure
                        </label>
                        <small class="form-text text-muted">Automatically retry failed operations</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>