<div class="advice-status-controller-designer">
    <!-- Header Section -->
    <div class="designer-header" data-bind="click: toggleExpanded">
        <div class="header-content">
            <i class="fa fa-code-fork designer-icon"></i>
            <span class="designer-title">Advice Status Controller</span>
            <span class="configuration-summary" data-bind="text: getConfigurationSummary"></span>
            <div class="header-actions">
                <button type="button" class="btn btn-link btn-sm info-button" 
                        data-bind="click: showInfo" 
                        title="Show detailed information about this workflow action">
                    <i class="fa fa-info-circle text-info"></i>
                </button>
                <i class="fa toggle-icon" data-bind="css: { 'fa-chevron-down': !isExpanded(), 'fa-chevron-up': isExpanded() }"></i>
            </div>
        </div>
    </div>
    
    <!-- Configuration Content -->
    <div class="designer-content" data-bind="visible: isExpanded">
        
        <!-- Validation Message -->
        <!-- ko if: validationMessage() -->
        <div class="alert alert-warning">
            <i class="fa fa-exclamation-triangle"></i>
            <span data-bind="text: validationMessage"></span>
        </div>
        <!-- /ko -->
        
        <!-- Variable Mappings Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-exchange"></i>
                Variable Mappings
            </h4>
            
            <div class="form-row">
                <div class="col-md-6">
                    <label>Work Item ID Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.workItemIdVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.workItemIdVariable,
                        placeholder: 'Select work item ID variable...',
                        required: true
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-6">
                    <label>Pause Reason Variable (Optional)</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.pauseReasonVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.pauseReasonVariable,
                        placeholder: 'Select pause reason variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
            </div>
        </div>
        
        <!-- Output Mappings Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-arrow-right"></i>
                Output Variables
            </h4>
            
            <div class="form-row">
                <div class="col-md-4">
                    <label>Success Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.successVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.successVariable,
                        placeholder: 'Select success variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Action Taken Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.actionTakenVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.actionTakenVariable,
                        placeholder: 'Select action taken variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Current Status Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.currentStatusVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.currentStatusVariable,
                        placeholder: 'Select current status variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
            </div>
            
            <div class="form-row">
                <div class="col-md-4">
                    <label>Paused Date Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.pausedDateVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.pausedDateVariable,
                        placeholder: 'Select paused date variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Resumed Date Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.resumedDateVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.resumedDateVariable,
                        placeholder: 'Select resumed date variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
                <div class="col-md-4">
                    <label>Last Action Date Variable</label>
                    <!-- ko if: viewModel && viewModel.ui && viewModel.ui.lastActionDateVariable -->
                    <div data-bind="widget: 'Components.Core.VariableSelector', widgetOptions: { 
                        variable: viewModel.ui.lastActionDateVariable,
                        placeholder: 'Select last action date variable...'
                    }"></div>
                    <!-- /ko -->
                </div>
            </div>
        </div>
        
        <!-- Action Configuration Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-cogs"></i>
                Action Configuration
            </h4>
            
            <div class="form-row">
                <div class="col-md-6">
                    <label>Default Action</label>
                    <!-- ko if: viewModel && viewModel.config && viewModel.config.defaultAction -->
                    <select class="form-control" data-bind="
                        options: availableActions,
                        optionsText: 'text',
                        optionsValue: 'value',
                        value: viewModel.config.defaultAction">
                    </select>
                    <!-- /ko -->
                    <small class="form-text text-muted">Action to take when no conditions match</small>
                </div>
                <div class="col-md-6">
                    <label>
                        <!-- ko if: viewModel && viewModel.config && viewModel.config.requireConfirmation -->
                        <input type="checkbox" data-bind="checked: viewModel.config.requireConfirmation" />
                        <!-- /ko -->
                        Require Confirmation
                    </label>
                    <small class="form-text text-muted">Require user confirmation before taking action</small>
                </div>
            </div>
        </div>
        
        <!-- Conditions Section -->
        <div class="configuration-section">
            <h4 class="section-title">
                <i class="fa fa-list"></i>
                Conditions
                <button type="button" class="btn btn-sm btn-primary ml-2" data-bind="click: addCondition">
                    <i class="fa fa-plus"></i> Add Condition
                </button>
            </h4>
            
            <!-- ko if: viewModel && viewModel.config && viewModel.config.conditions -->
            <!-- ko if: viewModel.config.conditions().length === 0 -->
            <div class="alert alert-info">
                <i class="fa fa-info-circle"></i>
                No conditions defined. The default action will always be used.
            </div>
            <!-- /ko -->
            
            <!-- ko foreach: viewModel.config.conditions -->
            <div class="condition-row">
                <div class="form-row">
                    <div class="col-md-4">
                        <label>When Status Is</label>
                        <select class="form-control" data-bind="
                            options: $parent.availableConditions,
                            optionsText: 'text',
                            optionsValue: 'value',
                            value: when">
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label>Then Action</label>
                        <select class="form-control" data-bind="
                            options: $parent.availableActions,
                            optionsText: 'text',
                            optionsValue: 'value',
                            value: then">
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label>&nbsp;</label>
                        <div>
                            <button type="button" class="btn btn-sm btn-danger" data-bind="click: $parent.removeCondition">
                                <i class="fa fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko -->
            <!-- /ko -->
        </div>
        
        <!-- Advanced Options -->
        <div class="configuration-section">
            <h4 class="section-title" data-bind="click: toggleAdvancedOptions" style="cursor: pointer;">
                <i class="fa" data-bind="css: { 'fa-chevron-right': !showAdvancedOptions(), 'fa-chevron-down': showAdvancedOptions() }"></i>
                Advanced Options
            </h4>
            
            <div data-bind="visible: showAdvancedOptions">
                <div class="form-row">
                    <div class="col-md-6">
                        <label>
                            <!-- ko if: viewModel && viewModel.config && viewModel.config.enableLogging -->
                            <input type="checkbox" data-bind="checked: viewModel.config.enableLogging" />
                            <!-- /ko -->
                            Enable Detailed Logging
                        </label>
                        <small class="form-text text-muted">Log detailed execution information</small>
                    </div>
                    <div class="col-md-6">
                        <label>
                            <!-- ko if: viewModel && viewModel.config && viewModel.config.retryOnFailure -->
                            <input type="checkbox" data-bind="checked: viewModel.config.retryOnFailure" />
                            <!-- /ko -->
                            Retry on Failure
                        </label>
                        <small class="form-text text-muted">Automatically retry failed operations</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Information Modal -->
    <!-- ko if: infoModal -->
    <!-- ko with: infoModal -->
    <div class="modal workflow-action-info-modal" data-bind="visible: isVisible, event: { keypress: handleKeyPress }" style="display: none;" tabindex="-1">
        <div class="modal-backdrop" data-bind="click: hide"></div>
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title-section">
                        <i class="fa fa-info-circle text-info modal-icon"></i>
                        <h4 class="modal-title" data-bind="text: actionInfo.name || 'Workflow Action Information'"></h4>
                        <span class="badge badge-primary" data-bind="text: actionInfo.category || 'Workflow'"></span>
                    </div>
                    <button type="button" class="close" data-bind="click: hide" title="Close Information">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-nav">
                    <ul class="nav nav-tabs" role="tablist">
                        <!-- ko foreach: availableTabs -->
                        <li class="nav-item">
                            <a class="nav-link" 
                               data-bind="css: { active: $parent.currentTab() === id }, click: function() { $parent.switchTab(id); }"
                               href="#" role="tab">
                                <i class="fa" data-bind="css: icon"></i>
                                <span data-bind="text: title"></span>
                            </a>
                        </li>
                        <!-- /ko -->
                    </ul>
                </div>
                <div class="modal-body">
                    <div class="tab-content" data-bind="visible: currentTab() === 'overview'">
                        <div class="info-section">
                            <h5><i class="fa fa-info-circle"></i> Description</h5>
                            <p data-bind="text: actionInfo.description || 'No description available.'"></p>
                            
                            <!-- ko if: actionInfo.purpose -->
                            <h5><i class="fa fa-target"></i> Purpose</h5>
                            <p data-bind="text: actionInfo.purpose"></p>
                            <!-- /ko -->
                            
                            <!-- ko if: actionInfo.useCases && actionInfo.useCases.length > 0 -->
                            <h5><i class="fa fa-lightbulb-o"></i> Use Cases</h5>
                            <ul class="use-cases-list">
                                <!-- ko foreach: actionInfo.useCases -->
                                <li data-bind="text: $data"></li>
                                <!-- /ko -->
                            </ul>
                            <!-- /ko -->
                        </div>
                    </div>
                    
                    <div class="tab-content" data-bind="visible: currentTab() === 'configuration'">
                        <!-- ko if: getConfigurationParameters().length > 0 -->
                        <div class="info-section">
                            <h5><i class="fa fa-cogs"></i> Configuration Parameters</h5>
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>Type</th>
                                            <th>Required</th>
                                            <th>Default</th>
                                            <th>Description</th>
                                        </tr>
                                    </thead>
                                    <tbody data-bind="foreach: getConfigurationParameters">
                                        <tr>
                                            <td><code data-bind="text: name"></code></td>
                                            <td><span class="badge badge-secondary" data-bind="text: type"></span></td>
                                            <td>
                                                <i class="fa" data-bind="css: { 'fa-check text-success': required, 'fa-times text-muted': !required }"></i>
                                            </td>
                                            <td><code data-bind="text: $data.default"></code></td>
                                            <td data-bind="text: description"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- /ko -->
                    </div>
                    
                    <div class="tab-content" data-bind="visible: currentTab() === 'examples'">
                        <!-- ko if: getUsageExamples().length > 0 -->
                        <!-- ko foreach: getUsageExamples -->
                        <div class="example-section">
                            <h5>
                                <i class="fa fa-code"></i>
                                <span data-bind="text: title"></span>
                            </h5>
                            <p><strong>Scenario:</strong> <span data-bind="text: scenario"></span></p>
                            <div class="code-example">
                                <div class="code-header">
                                    <span>Configuration</span>
                                </div>
                                <pre><code data-bind="text: JSON.stringify(configuration, null, 2)"></code></pre>
                            </div>
                            <p><strong>Expected Result:</strong> <span data-bind="text: expected"></span></p>
                        </div>
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>
                    
                    <div class="tab-content" data-bind="visible: currentTab() === 'debugging'">
                        <div class="info-section">
                            <h5><i class="fa fa-bug"></i> Debugging Information</h5>
                            <div class="debug-tools">
                                <h6>Debug URL</h6>
                                <p>Use this URL to enable detailed logging:</p>
                                <div class="input-group">
                                    <input type="text" class="form-control" readonly data-bind="value: getDebugUrl">
                                    <div class="input-group-append">
                                        <button type="button" class="btn btn-outline-secondary" 
                                                data-bind="click: function() { copyToClipboard(getDebugUrl()); }"
                                                title="Copy debug URL">
                                            <i class="fa fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" data-bind="visible: currentTab() === 'troubleshooting'">
                        <!-- ko if: getTroubleshootingScenarios().length > 0 -->
                        <!-- ko foreach: getTroubleshootingScenarios -->
                        <div class="troubleshooting-scenario">
                            <h5>
                                <i class="fa fa-exclamation-triangle text-warning"></i>
                                <span data-bind="text: problem"></span>
                            </h5>
                            <!-- ko if: symptoms.length > 0 -->
                            <div class="scenario-section">
                                <h6><i class="fa fa-eye"></i> Symptoms</h6>
                                <ul data-bind="foreach: symptoms">
                                    <li data-bind="text: $data"></li>
                                </ul>
                            </div>
                            <!-- /ko -->
                            <!-- ko if: solutions.length > 0 -->
                            <div class="scenario-section">
                                <h6><i class="fa fa-wrench"></i> Solutions</h6>
                                <ol data-bind="foreach: solutions">
                                    <li data-bind="text: $data"></li>
                                </ol>
                            </div>
                            <!-- /ko -->
                        </div>
                        <!-- /ko -->
                        <!-- /ko -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bind="click: hide">
                        <i class="fa fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- /ko -->
    <!-- /ko -->
</div>